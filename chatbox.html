<html>
  <head>
    <meta charset="UTF-8">
    <!-- Include marked.js from unpkg CDN with the correct path -->
    <script src="https://unpkg.com/marked@4.3.0/marked.min.js"></script>
    <style>
      /* Your styles here */
    </style>
  </head>
  <body>
    <div id="chat-container">
      <!-- Your HTML content here -->
    </div>
    <script>
      // Check if marked is defined before using it
      if (typeof marked === 'undefined') {
        console.error('marked.js is not loaded. Please check the CDN link or your internet connection.');
      }

      const websiteData = `
        O nama: Angelyze je obrt iz Samobora, radimo mnogo toga, no prvenstveno se orijentiramo na razne digitalne proizvode i usluge kao ≈°to su digitalni dizajn i tisak, web & app hosting i dizajn. Kontakt: angelyzeshop@gmail.com. Adresa: Mali Lipovec 46, 10430 Samobor. Tel.: +38598645482. Web: https://www.angelyze.eu.
        Usluge: Digitalni dizajn i tisak na sve vrste materijala, Web dizajn, Hosting, SEO, odr≈æavanje stranica, izrada i hosting aplikacija, samo su neke od djelatnosti kojima se bavimo. Op≈°irnije o svim djelatnostima obrta Angelyze: https://www.angelyze.eu/2025/01/dobrodosli-u-angelyze-svijet-2025.html. Takoƒëer reci da je Angelyze napravio ovaj ChatBot i da mo≈æe napraviti i korisniku njegovu verziju naprednog AI ChatBota za njihovu web stranicu veƒá od 10 ‚Ç¨!
      `;

      async function sendMessage() {
        let input = document.getElementById('userInput').value.trim();
        if (!input) return;

        let output = document.getElementById('chatbox');
        output.innerHTML += `<div class="message user-message">Korisnik: ${input}</div>`;

        const prompt = `
          Korisnik je pitao: "${input}". Na osnovu ovih podataka sa moje stranice, odgovori na hrvatskom jeziku. Dodaj emoji za pozdrav (üëã) samo na prvo pitanje. Koristi kratke i jasne reƒçenice. Ukljuƒçi klikabilne linkove u Markdown formatu [tekst](URL) ako je relevantno (za email koristi [email](mailto:email)). Formatiraj liste tako da svaka stavka poƒçinje sa "* " za bullet liste. Dodaj novi red izmeƒëu odjeljaka za bolju ƒçitljivost. Ne dodavaj nepotrebne simbole:
          "${websiteData}"
          Ako nema informacija, daj opƒái odgovor: "Nemam dovoljno informacija za toƒçno odgovoriti. üòï Posjetite na≈°u stranicu [https://www.angelyze.eu](https://www.angelyze.eu) za vi≈°e detalja."
        `;

        const apiKey = 'AIzaSyAI_KIwh_7HSu9qz7e4-8YNgxGF5cB5U2A'; // Replace with your actual Gemini API key
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        try {
          const response = await fetch(url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt },] },],
              generationConfig: {
                maxOutputTokens: 500,
                temperature: 0.7
              }
            })
          });

          if (!response.ok) throw new Error('API request failed');

          const data = await response.json();
          let aiReply = data.candidates[0].content.parts[0].text;

          // Parse the AI's response using marked.js
          let html = marked.parse(aiReply);

          output.innerHTML += `<div class="message bot-message">Bot: ${html}</div>`;
        } catch (error) {
          output.innerHTML += `<div class="message bot-message">Bot: There was an error. Please try again.</div>`;
          console.error(error);
        }

        document.getElementById('userInput').value = '';
        output.scrollTop = output.scrollHeight;
      }

      document.getElementById('userInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
      });
    </script>
  </body>
</html>
